<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>GO APPLE â€” Formulario</title>
<style>
  :root{ --bg:#ffffff; --surface:#ffffff; --line:#e6e6e9; --ink:#1d1d1f; --muted:#6e6e73; --accent:#0071e3; --radius:16px; }
  *{box-sizing:border-box} html,body{height:100%}
  body{ margin:0; background:linear-gradient(180deg,#f7f8fb,#eef1f6); color:var(--ink);
        font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",Segoe UI,Roboto,Helvetica,Arial,sans-serif;
        display:grid; place-items:center; padding:18px; }
  .card{ width:min(640px,94vw); background:var(--surface); border:1px solid var(--line); border-radius:var(--radius);
         box-shadow:0 20px 60px rgba(0,0,0,.10); overflow:hidden; }
  header{ padding:20px 22px 0; text-align:center; }
  h1{ margin:0; font-size:24px; font-weight:800; } 
  p.lead{ margin:8px 0 16px; color:#424245; font-size:15px; }
  .form-body{ padding:18px; display:grid; gap:14px; } .row{ display:grid; gap:10px; }
  label{ font-size:13px; color:#424245; font-weight:600; }
  input,select{ width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--line); background:#fafafa; font-size:14px; outline:none; }
  input[type="email"]:invalid{ border-color:#ffb4b4; }
  .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:4px; }
  .btn{ appearance:none; padding:11px 16px; border-radius:999px; font-weight:700; cursor:pointer; border:1px solid #cfd2d8; background:#fff; }
  .btn.primary{ background:var(--accent); color:#fff; border-color:var(--accent); } .btn:hover{ filter:brightness(.98); }
  .hidden{ display:none !important; } 
  footer.note{ padding:0 18px 18px; color:#6e6e73; font-size:12.5px; text-align:center; }

  /* Mensaje final */
  .final-wrap{ padding:26px 22px 28px; text-align:center; }
  .final-emoji{ font-size:42px; }
  .final-title{ margin:10px 0 6px; font-size:22px; font-weight:800; }
  .final-text{ margin:0 auto; max-width:520px; color:#424245; font-size:15px; line-height:1.45; }
  .final-badge{ display:inline-block; margin-top:14px; padding:6px 12px; border-radius:999px; background:#eff6ff; color:#1e40af; font-weight:700; font-size:12.5px; border:1px solid #dbeafe; }
  .final-ok{ margin-top:16px; padding:10px 16px; border-radius:999px; border:1px solid #cfd2d8; background:#fff; font-weight:700; cursor:default; color:#1d1d1f; }
</style>
</head>
<body>
<main class="card" role="dialog" aria-modal="true" aria-labelledby="form-title">
  <header id="hdr">
    <h1 id="form-title">ðŸ”¥ GanÃ¡ 10% de Descuento ðŸ”¥</h1>
    <p class="lead" id="form-lead">CompletÃ¡ el formulario y accedÃ© a un <strong>10% OFF</strong> en tu prÃ³ximo iPhone.</p>
  </header>

  <section class="form-body" id="form-body">
    <!-- Paso 1 -->
    <div id="step1" class="row">
      <div>
        <label for="lf-name">Nombre</label>
        <input id="lf-name" type="text" placeholder="Tu nombre" autocomplete="name" />
      </div>
      <div>
        <label for="lf-email">Correo</label>
        <input id="lf-email" type="email" placeholder="tu@email.com" autocomplete="email" required />
      </div>
      <div>
        <label for="lf-phone">WhatsApp</label>
        <input id="lf-phone" type="tel" placeholder="+54 9 ..." inputmode="tel" autocomplete="tel" />
      </div>
      <div class="actions">
        <button class="btn" id="cancel">Cancelar</button>
        <button class="btn primary" id="next">Continuar</button>
      </div>
    </div>

    <!-- Paso 2 -->
    <div id="step2" class="row hidden">
      <div>
        <label for="lf-budget">Â¿CuÃ¡l es tu inversiÃ³n (ARS)?</label>
        <select id="lf-budget">
          <option value="menos">Menos de $300.000</option>
          <option value="400-600">$400.000 a $600.000</option>
          <option value="700-900">$700.000 a $900.000</option>
          <option value="mas900">MÃ¡s de $900.000</option>
        </select>
      </div>
      <div class="actions">
        <button class="btn" id="back">Volver</button>
        <button class="btn primary" id="send">Enviar</button>
      </div>
    </div>
  </section>

  <footer class="note" id="note">Completando el formulario obtenÃ©s tu beneficio del 10% OFF.</footer>
</main>

<script>
(function(){
  const KEY='lead_form_done_v1';
  const KEY_LOW='lead_low_budget_v1';

  const $card=document.querySelector('main.card');
  const $hdr=document.getElementById('hdr');
  const $body=document.getElementById('form-body');
  const $note=document.getElementById('note');

  const $s1=document.getElementById('step1');
  const $s2=document.getElementById('step2');
  const $name=document.getElementById('lf-name');
  const $mail=document.getElementById('lf-email');
  const $tel=document.getElementById('lf-phone');
  const $bud=document.getElementById('lf-budget');

  // Si ya declarÃ³ presupuesto "menos", mostrar mensaje final y bloquear form
  if (sessionStorage.getItem(KEY_LOW) === '1') {
    renderFinalMessage();
    disableFormForever();
  }

  const EMAIL_RE=/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
  const emailOk=v=> EMAIL_RE.test((v||'').trim()) && $mail.checkValidity();
  const phoneOk=v=> ((v||'').match(/\\d/g) || []).length >= 8;
  const requiredFilled=()=> ($name.value||'').trim() && emailOk($mail.value) && phoneOk($tel.value);

  document.getElementById('next').onclick=()=>{
    if(!requiredFilled()){
      alert('CompletÃ¡ nombre, correo y WhatsApp vÃ¡lidos.');
      return;
    }
    $s1.classList.add('hidden'); $s2.classList.remove('hidden'); $bud.focus();
  };

  document.getElementById('back').onclick=()=>{ $s2.classList.add('hidden'); $s1.classList.remove('hidden'); };
  document.getElementById('cancel').onclick=()=>{ history.back(); };

  function goCatalog(){
    const target = new URL('/', 'https://goapple-catalogo.vercel.app');
    const qs = new URLSearchParams({
      name: ($name.value||'').trim(),
      email: ($mail.value||'').trim(),
      phone: ($tel.value||'').trim(),
      budget: $bud.value
    });
    target.search = qs.toString();
    window.location.href = target.toString();
  }

  function renderFinalMessage(){
    // Reemplazamos el contenido por un mensaje final sin opciones de volver
    $hdr.innerHTML = '<div class="final-wrap"><div class="final-emoji">ðŸ‘‹</div><h2 class="final-title">Â¡Gracias por tu interÃ©s!</h2><p class="final-text">Por el momento no contamos con stock dentro de ese presupuesto. En breve ingresan iPhones nuevos ðŸ“². Te voy a contactar apenas tengamos disponibilidad para que aproveches tu <strong>10% OFF</strong>.</p><span class="final-badge">Tu solicitud quedÃ³ registrada</span><div><button class="final-ok" aria-disabled="true">Entendido</button></div></div>';
    $body.remove(); // eliminamos el formulario completo
    $note.textContent = 'Nos pondremos en contacto automÃ¡ticamente ni bien haya disponibilidad.';
  }

  function disableFormForever(){
    // Bloqueamos cualquier interacciÃ³n y evitamos que reabran pasos
    sessionStorage.setItem(KEY,'1');
    sessionStorage.setItem(KEY_LOW,'1');

    // Evitar que el usuario "vuelva" y cambie presupuesto en esta sesiÃ³n
    try {
      history.pushState({blocked:true}, '');
      window.addEventListener('popstate', (e)=>{
        if (sessionStorage.getItem(KEY_LOW) === '1') {
          history.pushState({blocked:true}, '');
        }
      });
    } catch(_) {}
  }

  document.getElementById('send').onclick=()=>{
    const budget=$bud.value;

    const params=new URLSearchParams(location.search);
    params.set('name',($name.value||'').trim());
    params.set('email',($mail.value||'').trim());
    params.set('phone',($tel.value||'').trim());
    params.set('budget',budget);
    history.replaceState({},'',location.pathname+'?'+params.toString());
    sessionStorage.setItem(KEY,'1');

    try{ if(window.fbq){ fbq('track','Lead',{ value: budget, currency:'ARS' }); } }catch(_){}

    if(budget==='menos'){
      // Mostrar mensaje final y bloquear regresar a cambiar el presupuesto
      renderFinalMessage();
      disableFormForever();
      return;
    }

    if(budget==='400-600' || budget==='700-900' || budget==='mas900'){
      goCatalog();
    } else {
      alert('Â¡Gracias! Ya ganaste tu 10% OFF ðŸŽ‰');
    }
  };
})();
</script>
</body>
</html>